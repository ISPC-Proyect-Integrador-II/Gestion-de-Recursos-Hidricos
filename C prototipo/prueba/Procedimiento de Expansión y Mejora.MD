
# üèóÔ∏è **Procedimiento de Expansi√≥n y Mejora: Hidroponia Inteligente en ESP32**  

## üìå **1. Introducci√≥n**  
Este documento describe c√≥mo se pueden modificar y mejorar los diferentes m√≥dulos del sistema hidrop√≥nico, permitiendo agregar nuevos sensores, ampliar la comunicaci√≥n y optimizar la automatizaci√≥n.  

El sistema est√° dise√±ado en **arquitectura modular**, lo que significa que cada funcionalidad es independiente y puede ser modificada sin afectar el resto del c√≥digo.  

---

## üìå **2. Agregar un Nuevo Sensor al Sistema**  

Para agregar un nuevo sensor, sigue estos pasos:  

### **1Ô∏è‚É£ Definir el nuevo sensor en `sensores.h`**  
Agrega el pin en el archivo `sensores.h`, por ejemplo, si deseas incluir un sensor de **CO2**:  
```cpp
#define SENSOR_CO2_PIN 37
```

### **2Ô∏è‚É£ Crear la funci√≥n de lectura en `sensores.cpp`**  
Define la funci√≥n para leer los datos del sensor:  
```cpp
float leerCO2() {
    return analogRead(SENSOR_CO2_PIN) * 0.1; // Ajustar seg√∫n el sensor espec√≠fico
}
```

### **3Ô∏è‚É£ Modificar `loop()` en `Hidroponia.ino`**  
Agrega la lectura del sensor en cada ciclo de ejecuci√≥n del ESP32:  
```cpp
float co2 = leerCO2();
Serial.println("CO2: " + String(co2));
```

### **4Ô∏è‚É£ Enviar los datos v√≠a MQTT en `transmisor.cpp`**  
Si el sistema est√° conectado a la nube, puedes enviar los datos del nuevo sensor por MQTT:  
```cpp
String datos = "{\"CO2\":" + String(co2) + "}";
client.publish("hidroponia/datos", datos.c_str());
```

‚úî **Con estos pasos, el nuevo sensor se integrar√° al sistema sin afectar las dem√°s funciones.**  

---

## üìå **3. Agregar un Nuevo Men√∫ en la Pantalla TFT**  

Si necesitas un nuevo men√∫ para mostrar informaci√≥n espec√≠fica, sigue estos pasos:  

### **1Ô∏è‚É£ Definir el nuevo men√∫ en `menu.h`**  
```cpp
void mostrarMenuEstadisticas();
```

### **2Ô∏è‚É£ Implementar el men√∫ en `menu.cpp`**  
```cpp
void mostrarMenuEstadisticas() {
    tft.fillScreen(ST7735_BLACK);
    tft.setCursor(10, 10);
    tft.setTextSize(1);
    tft.setTextColor(ST7735_WHITE);
    tft.println("[ ESTAD√çSTICAS ]");
    tft.println("Promedio de pH: " + String(promedioPH));
    tft.println("Flujo medio: " + String(promedioFlujoAgua));
}
```

### **3Ô∏è‚É£ Agregar la opci√≥n en el men√∫ principal (`menu.cpp`)**  
```cpp
tft.println(opcionMenu == 4 ? "> Estad√≠sticas" : "  Estad√≠sticas");
```

### **4Ô∏è‚É£ Manejar la selecci√≥n del nuevo men√∫**  
```cpp
if (opcionMenu == 4) mostrarMenuEstadisticas();
```

‚úî **Este m√©todo permite expandir el men√∫ sin modificar otros m√≥dulos del sistema.**  

---

## üìå **4. Agregar una Nueva Automatizaci√≥n**  

Si deseas mejorar el control del sistema agregando una funci√≥n para **ajustar nutrientes seg√∫n el pH**, sigue estos pasos:  

### **1Ô∏è‚É£ Definir la nueva l√≥gica en `control.h`**  
```cpp
void ajustarNutrientes();
```

### **2Ô∏è‚É£ Implementar la funci√≥n en `control.cpp`**  
```cpp
void ajustarNutrientes() {
    if (phValor < 5.8) {
        Serial.println("Agregando nutrientes alcalinos.");
    } else if (phValor > 7.2) {
        Serial.println("Agregando nutrientes √°cidos.");
    } else {
        Serial.println("pH dentro del rango √≥ptimo.");
    }
}
```

### **3Ô∏è‚É£ Llamar a la funci√≥n en `loop()` en `Hidroponia.ino`**  
```cpp
ajustarNutrientes();
```

‚úî **Este m√©todo permite agregar funciones de automatizaci√≥n sin cambiar la estructura base del c√≥digo.**  

---

## üìå **5. Optimizaci√≥n de la Comunicaci√≥n**  

Si deseas enviar datos no solo por MQTT, sino tambi√©n por **LoRa Mesh y BLE Mesh simult√°neamente**, puedes hacerlo modificando `transmisor.cpp`:  

```cpp
void enviarDatos() {
    if (!esNodoTransmisor) return;
    
    String datos = "{\"tempAgua\":" + String(temperaturaAgua) + "}";

    client.publish("hidroponia/datos", datos.c_str());  // MQTT
    enviarDatosLoRa(datos);  // LoRa Mesh
    enviarDatosBLE(datos);  // BLE Mesh
}
```

‚úî **Este m√©todo permite que el ESP32 comunique los datos por m√∫ltiples canales sin modificar el resto del sistema.**  

---

## üìå **6. Agregar M√°s Recetas de Cultivo**  

Si deseas ampliar la cantidad de recetas almacenadas en **EEPROM**, sigue estos pasos:  

### **1Ô∏è‚É£ Modificar `recetas.h` para aumentar el l√≠mite**  
```cpp
#define MAX_RECETAS 10 // Cambia el n√∫mero seg√∫n lo necesario
```

### **2Ô∏è‚É£ Agregar nuevas recetas en `recetas.cpp`**  
```cpp
Receta recetas[MAX_RECETAS] = {
    {"Lechuga", 20.0, 22.0, 70.0, 10.0, 6.2, true},
    {"Tomate", 22.0, 25.0, 65.0, 15.0, 5.8, true},
    {"Albahaca", 21.0, 23.0, 75.0, 12.0, 6.5, true},
    {"Perejil", 19.0, 21.0, 80.0, 8.0, 6.0, false},
    {"Fresas", 20.0, 24.0, 68.0, 12.0, 5.5, true},
    {"Menta", 18.5, 21.0, 77.0, 9.0, 6.3, true},
    {"Cilantro", 20.0, 22.5, 79.0, 10.5, 6.1, false},
    {"Pimiento", 23.0, 26.0, 60.0, 14.0, 5.7, true},
    {"Espinaca", 19.0, 22.0, 75.0, 10.0, 6.4, false},
    {"Frambuesas", 20.5, 23.5, 69.0, 11.0, 5.6, true}
};
```

‚úî **Este m√©todo permite expandir la lista de cultivos sin afectar la l√≥gica del sistema.**  

---

